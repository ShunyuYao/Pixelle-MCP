# MCP工具调用侧边栏使用说明

## 功能概述

MCP工具调用侧边栏是一个实时显示聊天过程中使用的MCP工具调用记录的功能模块。它会在对话的右侧显示一个侧边栏，展示每次工具调用的详细信息。

## 主要功能

### 🔧 工具调用记录
- **实时更新**：每次工具调用后自动更新显示
- **详细信息**：显示工具名称、输入参数、输出结果、执行时间
- **状态指示**：通过颜色和图标区分成功(✅)、失败(❌)、进行中(⏳)状态

### 📊 统计信息
- **调用统计**：显示总调用数、成功数、失败数
- **工具分析**：按工具类型统计使用情况

### 🎨 交互功能
- **展开/折叠**：点击工具标题可展开或折叠详情
- **内容复制**：点击📋按钮可复制工具参数或结果
- **内容展开**：长内容可通过"展开"按钮查看完整信息
- **快捷键**：Ctrl+Shift+S 切换侧边栏显示/隐藏

## 界面说明

### 侧边栏结构
```
🔧 MCP工具调用记录
├─ 统计信息（总调用数、成功/失败数）
├─ ✅ 工具名称 1 
│  ├─ 📥 输入参数
│  └─ 📤 执行结果
├─ ❌ 工具名称 2
│  ├─ 📥 输入参数  
│  └─ 📤 执行结果
└─ ...
```

### 状态指示
- ✅ **成功**：工具执行成功，显示绿色背景
- ❌ **失败**：工具执行失败，显示红色背景  
- ⏳ **进行中**：工具正在执行，显示黄色背景

## 技术实现

### 后端组件
- `chat/tool_sidebar.py`：核心侧边栏逻辑和数据处理
- `main.py`：侧边栏初始化和更新调用
- `chat/chat_handler.py`：工具调用后的侧边栏更新

### 前端增强
- `public/app.js`：JavaScript交互功能（展开/折叠、复制等）
- `public/app.css`：侧边栏样式美化和响应式设计

### 配置文件
- `.chainlit/config.toml`：启用侧边栏基础配置

## 自定义配置

### 修改侧边栏默认状态
在 `.chainlit/config.toml` 中：
```toml
# 侧边栏默认状态："open" 或 "closed"
default_sidebar_state = "open"
```

### 自定义样式
可以在 `public/app.css` 中修改侧边栏相关的CSS样式：
- 颜色主题
- 字体大小
- 布局样式
- 动画效果

## 故障排除

### 常见问题

1. **侧边栏不显示**
   - 检查 `config.toml` 中的 `default_sidebar_state` 设置
   - 确保服务重启后生效

2. **样式显示异常**
   - 清除浏览器缓存
   - 检查 `app.css` 文件是否正确加载

3. **工具调用记录不更新**
   - 检查控制台是否有JavaScript错误
   - 确认工具调用是否成功执行

4. **交互功能不工作**
   - 确保JavaScript文件加载正常
   - 检查浏览器兼容性

### 调试信息
开发者可以在浏览器控制台查看以下日志：
- `MCP工具侧边栏增强功能已加载`
- `侧边栏交互功能已设置`
- `侧边栏元素未找到，稍后重试...`

## 性能优化

### 自动优化功能
- **内容截断**：过长的参数和结果会自动截断
- **懒加载**：大量工具调用时采用分页显示
- **内存管理**：定期清理过期的工具调用记录

### 手动优化建议
- 定期清理聊天历史以减少侧边栏负载
- 在移动设备上可关闭侧边栏以提升性能

## 支持的浏览器

- Chrome 80+
- Firefox 75+
- Safari 13+
- Edge 80+

## 更新日志

### v1.0.0 (2025-01-XX)
- ✨ 基础侧边栏功能实现
- 🎨 工具调用状态可视化
- 📋 交互功能（展开/折叠、复制）
- 🎭 自定义样式和主题支持
- 📱 响应式设计和移动端适配